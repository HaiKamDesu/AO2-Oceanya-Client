<local:OceanyaWindowContentControl x:Class="OceanyaClient.TagFilterSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:OceanyaClient"
        Title="Filters &amp; Sorting"
        Height="680"
        Width="980"
        MinHeight="520"
        MinWidth="720"
        Loaded="Window_Loaded"
        SizeChanged="Window_SizeChanged">

    <local:OceanyaWindowContentControl.Resources>
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,5"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF3D3D3D" TargetName="ButtonBorder"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF171717" TargetName="ButtonBorder"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF1A1A1A" TargetName="ButtonBorder"/>
                                <Setter Property="BorderBrush" Value="#FF333333" TargetName="ButtonBorder"/>
                                <Setter Property="Foreground" Value="#FF7A7A7A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFE81123" TargetName="ButtonBorder"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FFC41E3A" TargetName="ButtonBorder"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="Foreground" Value="#FFF2F2F2"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="#FFECECEC"/>
            <Setter Property="Background" Value="#FF1F1F1F"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="ItemBorder" Background="{TemplateBinding Background}">
                            <ContentPresenter VerticalAlignment="Center"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              Margin="0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF36506A"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF3D5E7F"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="BorderBrush" Value="#FF444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,0,28,0"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="ItemContainerStyle" Value="{StaticResource DarkComboBoxItemStyle}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid SnapsToDevicePixels="True">
                            <Border x:Name="MainBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="3"/>

                            <ToggleButton x:Name="DropdownToggle"
                                          Focusable="False"
                                          ClickMode="Press"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Stretch"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Background="Transparent"
                                          BorderThickness="0">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="Transparent"/>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>

                            <ContentPresenter x:Name="SelectionBoxPresenter"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Stretch"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              TextElement.Foreground="{TemplateBinding Foreground}"/>

                            <TextBox x:Name="PART_EditableTextBox"
                                     Margin="{TemplateBinding Padding}"
                                     VerticalContentAlignment="Center"
                                     HorizontalContentAlignment="Left"
                                     Foreground="{TemplateBinding Foreground}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Visibility="Hidden"
                                     Focusable="True"/>

                            <Path HorizontalAlignment="Right"
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"
                                  IsHitTestVisible="False"
                                  Fill="#FFDCDCDC"
                                  Data="M 0 0 L 8 0 L 4 5 Z"/>

                            <Popup x:Name="PART_Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Margin="0,2,0,0"
                                        MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}"
                                        Background="#FF1F1F1F"
                                        BorderBrush="#FF4A4A4A"
                                        BorderThickness="1"
                                        CornerRadius="3">
                                    <ScrollViewer CanContentScroll="True" MaxHeight="320">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEditable" Value="True">
                                <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="SelectionBoxPresenter" Property="Visibility" Value="Hidden"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MainBorder" Property="Background" Value="#FF2A2A2A"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter TargetName="MainBorder" Property="BorderBrush" Value="#FF6E93BB"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="MainBorder" Property="Background" Value="#FF1A1A1A"/>
                                <Setter Property="Foreground" Value="#FF7A7A7A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernTabControl" TargetType="TabControl">
            <Setter Property="Background" Value="#FF252525"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style x:Key="ModernTabItem" TargetType="TabItem">
            <Setter Property="Foreground" Value="#D6D6D6"/>
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="TabBorder"
                                BorderBrush="#444444"
                                BorderThickness="1,1,1,0"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="#FF3A3A3A"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="#FF333333"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="#00000000"/>
            <Setter Property="AlternatingRowBackground" Value="#0DFFFFFF"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#33444444"/>
            <Setter Property="VerticalGridLinesBrush" Value="#33444444"/>
        </Style>

        <Style x:Key="DarkDataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Foreground" Value="#D8D8D8"/>
            <Setter Property="Background" Value="#FF2F2F2F"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="TagSuggestionListBoxStyle" TargetType="ListBox">
            <Setter Property="Background" Value="#FF1F1F1F"/>
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="BorderBrush" Value="#FF4A4A4A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <Style x:Key="TagSuggestionListBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Foreground" Value="#FFECECEC"/>
            <Setter Property="Background" Value="#00000000"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="ItemBorder" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF36506A"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FF3D5E7F"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="GroupOnlyStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsGroup}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ConditionOnlyStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsGroup}" Value="False">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ListOnlyStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding UsesListValues}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="NotListStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding UsesListValues}" Value="True">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="SecondValueStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding UsesSecondValue}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="FilterTreeItemStyle" TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="Background" Value="#00000000"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#334E5B63"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#24505C63"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkDatePickerStyle" TargetType="DatePicker">
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="BorderBrush" Value="#FF444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Padding" Value="6,0,6,0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style x:Key="DarkDatePickerTextBoxStyle" TargetType="DatePickerTextBox">
            <Setter Property="Background" Value="#FF262626"/>
            <Setter Property="Foreground" Value="#FFF0F0F0"/>
            <Setter Property="BorderBrush" Value="#FF444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,0,8,0"/>
            <Setter Property="CaretBrush" Value="#FFF0F0F0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="TagTokenStyle" TargetType="Border">
            <Setter Property="Background" Value="#2E4A5F"/>
            <Setter Property="BorderBrush" Value="#4C86AE"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Margin" Value="0,0,6,6"/>
        </Style>

        <DataTemplate x:Key="TagSuggestionTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock FontFamily="Segoe MDL2 Assets"
                           Text="&#xE8EC;"
                           Margin="0,0,6,0"
                           Foreground="#FF9FD0F5"/>
                <TextBlock Text="{Binding Name}" Foreground="#FFF0F0F0"/>
                <TextBlock Text="{Binding CountText}" Foreground="#FF9AA4AE" Margin="4,0,0,0"/>
            </StackPanel>
        </DataTemplate>

        <HierarchicalDataTemplate DataType="{x:Type local:FolderFilterRule}" ItemsSource="{Binding Children}">
            <Border Margin="0,0,0,6" Padding="8" BorderBrush="#445B5B5B" BorderThickness="1" Background="#191A1A1A" CornerRadius="3">
                <StackPanel>
                    <Grid Style="{StaticResource GroupOnlyStyle}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="130"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <CheckBox Grid.Column="0" IsChecked="{Binding IsActive}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox Grid.Column="1"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  SelectedItem="{Binding Connector}"
                                  ItemsSource="{Binding DataContext.ConnectorChoices, RelativeSource={RelativeSource AncestorType=Window}}"/>
                        <TextBlock Grid.Column="2" Text=" Group" VerticalAlignment="Center" Foreground="#FFE3E3E3" Margin="8,0,10,0"/>
                        <Button Grid.Column="3" Content="+ Condition" Width="98" Height="26" Margin="0,0,6,0" Style="{StaticResource ModernButton}" Click="AddConditionToNodeButton_Click"/>
                        <Button Grid.Column="4" Content="+ Group" Width="82" Height="26" Margin="0,0,6,0" Style="{StaticResource ModernButton}" Click="AddGroupToNodeButton_Click"/>
                        <Button Grid.Column="5" Content="Remove" Width="72" Height="26" Style="{StaticResource ModernButton}" Click="RemoveNodeButton_Click" IsEnabled="{Binding CanRemove}"/>
                    </Grid>

                    <Grid Style="{StaticResource ConditionOnlyStyle}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="170"/>
                            <ColumnDefinition Width="170"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <CheckBox Grid.Column="0" IsChecked="{Binding IsActive}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox Grid.Column="1"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  SelectedValuePath="Key"
                                  DisplayMemberPath="DisplayName"
                                  SelectedValue="{Binding ColumnKey}"
                                  ItemsSource="{Binding DataContext.ColumnChoices, RelativeSource={RelativeSource AncestorType=Window}}"/>
                        <ComboBox Grid.Column="2"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  SelectedItem="{Binding Operator}"
                                  ItemsSource="{Binding AvailableOperators}"
                                  Margin="6,0,0,0"/>

                        <TextBox Grid.Column="3"
                                 Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="6,0,0,0"
                                 Height="30">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UsesListValues}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding UsesEnumSelection}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding UsesDateInput}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <DatePicker Grid.Column="3"
                                    Margin="6,0,0,0"
                                    SelectedDate="{Binding ValueDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <DatePicker.Resources>
                                <Style TargetType="DatePickerTextBox" BasedOn="{StaticResource DarkDatePickerTextBoxStyle}"/>
                            </DatePicker.Resources>
                            <DatePicker.Style>
                                <Style TargetType="DatePicker" BasedOn="{StaticResource DarkDatePickerStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UsesDateInput}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DatePicker.Style>
                        </DatePicker>

                        <Button Grid.Column="3"
                                Grid.ColumnSpan="2"
                                Content="{Binding SelectedEnumSummary}"
                                Margin="6,0,0,0"
                                Click="EnumSelectionButton_Click">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ModernButton}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UsesEnumSelection}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <ItemsControl Grid.Column="3"
                                      Grid.ColumnSpan="2"
                                      Margin="6,0,0,0"
                                      ItemsSource="{Binding ListValues}"
                                      Style="{StaticResource ListOnlyStyle}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBox Style="{StaticResource ModernTextBox}"
                                             Width="120"
                                             Height="30"
                                             Margin="0,0,6,0"
                                             Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}"
                                             TextChanged="ListValueTextBox_TextChanged"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <TextBox Grid.Column="4"
                                 Text="{Binding SecondValue, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="6,0,0,0"
                                 Height="30">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UsesSecondValue}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding UsesDateInput}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <DatePicker Grid.Column="4"
                                    Margin="6,0,0,0"
                                    SelectedDate="{Binding SecondValueDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <DatePicker.Resources>
                                <Style TargetType="DatePickerTextBox" BasedOn="{StaticResource DarkDatePickerTextBoxStyle}"/>
                            </DatePicker.Resources>
                            <DatePicker.Style>
                                <Style TargetType="DatePicker" BasedOn="{StaticResource DarkDatePickerStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding UsesSecondValue}" Value="True"/>
                                                <Condition Binding="{Binding UsesDateInput}" Value="True"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DatePicker.Style>
                        </DatePicker>
                        <Button Grid.Column="5" Content="Remove" Width="72" Height="26" Margin="6,0,0,0" Style="{StaticResource ModernButton}" Click="RemoveNodeButton_Click" IsEnabled="{Binding CanRemove}"/>
                    </Grid>
                </StackPanel>
            </Border>
        </HierarchicalDataTemplate>
    </local:OceanyaWindowContentControl.Resources>

    <Grid Margin="12,10,12,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TabControl Grid.Row="0" x:Name="MainTabControl" Style="{StaticResource ModernTabControl}">
                    <TabItem Header="Tag Filters" Style="{StaticResource ModernTabItem}">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Included Tags" Foreground="#FFD8D8D8" Margin="0,0,0,6"/>
                            <Border Grid.Row="1" BorderBrush="#4AFFFFFF" BorderThickness="1" Background="#12000000" Padding="8">
                                <StackPanel>
                                    <ItemsControl ItemsSource="{Binding IncludedTagTokens}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource TagTokenStyle}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                                                   Text="&#xE8EC;"
                                                                   Margin="0,0,6,0"
                                                                   Foreground="#FF9FD0F5"/>
                                                        <TextBlock Text="{Binding Name}" Foreground="#FFF2F2F2"/>
                                                        <TextBlock Text="{Binding CountText}" Foreground="#FF9AA4AE" Margin="4,0,0,0"/>
                                                        <Button Content="✕"
                                                                Width="20"
                                                                Height="18"
                                                                Margin="6,0,0,0"
                                                                Style="{StaticResource ModernButton}"
                                                                FontSize="10"
                                                                Click="RemoveIncludedTagTokenButton_Click"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <Grid Margin="0,4,0,0">
                                        <TextBox x:Name="IncludeTagInputTextBox"
                                                 Style="{StaticResource ModernTextBox}"
                                                 TextChanged="IncludeTagInputTextBox_TextChanged"
                                                 PreviewKeyDown="IncludeTagInputTextBox_PreviewKeyDown"/>
                                        <Popup Placement="Bottom"
                                               PlacementTarget="{Binding ElementName=IncludeTagInputTextBox}"
                                               IsOpen="{Binding IsIncludeSuggestionsOpen, Mode=TwoWay}"
                                               StaysOpen="False"
                                               AllowsTransparency="True"
                                               PopupAnimation="Fade">
                                            <Border Margin="0,2,0,0"
                                                    MinWidth="{Binding ActualWidth, ElementName=IncludeTagInputTextBox}"
                                                    MaxHeight="320"
                                                    Background="#FF1F1F1F"
                                                    BorderBrush="#FF4A4A4A"
                                                    BorderThickness="1"
                                                    CornerRadius="3">
                                                <ListBox x:Name="IncludeSuggestionsListBox"
                                                         Style="{StaticResource TagSuggestionListBoxStyle}"
                                                         ItemsSource="{Binding IncludeTagSuggestions}"
                                                         ItemTemplate="{StaticResource TagSuggestionTemplate}">
                                                    <ListBox.ItemContainerStyle>
                                                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource TagSuggestionListBoxItemStyle}">
                                                            <EventSetter Event="PreviewMouseLeftButtonUp" Handler="IncludeSuggestionItem_PreviewMouseLeftButtonUp"/>
                                                        </Style>
                                                    </ListBox.ItemContainerStyle>
                                                </ListBox>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <TextBlock Grid.Row="2" Text="Excluded Tags" Foreground="#FFD8D8D8" Margin="0,10,0,6"/>
                            <Border Grid.Row="3" BorderBrush="#4AFFFFFF" BorderThickness="1" Background="#12000000" Padding="8">
                                <StackPanel>
                                    <ItemsControl ItemsSource="{Binding ExcludedTagTokens}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource TagTokenStyle}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                                                   Text="&#xE8EC;"
                                                                   Margin="0,0,6,0"
                                                                   Foreground="#FF9FD0F5"/>
                                                        <TextBlock Text="{Binding Name}" Foreground="#FFF2F2F2"/>
                                                        <TextBlock Text="{Binding CountText}" Foreground="#FF9AA4AE" Margin="4,0,0,0"/>
                                                        <Button Content="✕"
                                                                Width="20"
                                                                Height="18"
                                                                Margin="6,0,0,0"
                                                                Style="{StaticResource ModernButton}"
                                                                FontSize="10"
                                                                Click="RemoveExcludedTagTokenButton_Click"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <Grid Margin="0,4,0,0">
                                        <TextBox x:Name="ExcludeTagInputTextBox"
                                                 Style="{StaticResource ModernTextBox}"
                                                 TextChanged="ExcludeTagInputTextBox_TextChanged"
                                                 PreviewKeyDown="ExcludeTagInputTextBox_PreviewKeyDown"/>
                                        <Popup Placement="Bottom"
                                               PlacementTarget="{Binding ElementName=ExcludeTagInputTextBox}"
                                               IsOpen="{Binding IsExcludeSuggestionsOpen, Mode=TwoWay}"
                                               StaysOpen="False"
                                               AllowsTransparency="True"
                                               PopupAnimation="Fade">
                                            <Border Margin="0,2,0,0"
                                                    MinWidth="{Binding ActualWidth, ElementName=ExcludeTagInputTextBox}"
                                                    MaxHeight="320"
                                                    Background="#FF1F1F1F"
                                                    BorderBrush="#FF4A4A4A"
                                                    BorderThickness="1"
                                                    CornerRadius="3">
                                                <ListBox x:Name="ExcludeSuggestionsListBox"
                                                         Style="{StaticResource TagSuggestionListBoxStyle}"
                                                         ItemsSource="{Binding ExcludeTagSuggestions}"
                                                         ItemTemplate="{StaticResource TagSuggestionTemplate}">
                                                    <ListBox.ItemContainerStyle>
                                                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource TagSuggestionListBoxItemStyle}">
                                                            <EventSetter Event="PreviewMouseLeftButtonUp" Handler="ExcludeSuggestionItem_PreviewMouseLeftButtonUp"/>
                                                        </Style>
                                                    </ListBox.ItemContainerStyle>
                                                </ListBox>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Column Filters" Style="{StaticResource ModernTabItem}">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Text="Build nested filter groups (AND/OR) like a filter editor."
                                       Foreground="#FFD0D0D0"
                                       Margin="0,0,0,8"/>

                            <Border Grid.Row="1" BorderBrush="#4AFFFFFF" BorderThickness="1" Background="#12000000" Padding="8">
                                <TreeView x:Name="FilterTreeView"
                                          ItemsSource="{Binding FilterTreeRoots}"
                                          ItemContainerStyle="{StaticResource FilterTreeItemStyle}"
                                          Background="#00000000"
                                          BorderThickness="0"
                                          Foreground="#FFF0F0F0"
                                          VirtualizingPanel.IsVirtualizing="True"
                                          VirtualizingPanel.VirtualizationMode="Recycling">
                                    <TreeView.Resources>
                                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#334E5B63"/>
                                        <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="#334E5B63"/>
                                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFF0F0F0"/>
                                        <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="#FFF0F0F0"/>
                                    </TreeView.Resources>
                                </TreeView>
                            </Border>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,8,0,0">
                                <Button Content="Add Condition to Root" Width="165" Style="{StaticResource ModernButton}" Click="AddConditionToRootButton_Click"/>
                                <Button Content="Add Group to Root" Width="145" Margin="6,0,0,0" Style="{StaticResource ModernButton}" Click="AddGroupToRootButton_Click"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Sorting" Style="{StaticResource ModernTabItem}">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Sort Column" Foreground="#FFE6E6E6" Margin="0,0,0,4"/>
                            <ComboBox Grid.Row="1"
                                      x:Name="SortColumnCombo"
                                      Style="{StaticResource DarkComboBoxStyle}"
                                      ItemsSource="{Binding SortColumnChoices}"
                                      SelectedValuePath="Key"
                                      DisplayMemberPath="DisplayName"
                                      SelectedValue="{Binding SortColumn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                                <RadioButton x:Name="SortAscRadio" Content="Ascending" IsChecked="True" Foreground="#FFF0F0F0" Margin="0,0,16,0"/>
                                <RadioButton x:Name="SortDescRadio" Content="Descending" Foreground="#FFF0F0F0"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>
                </TabControl>

                <Grid Grid.Row="1" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               x:Name="SelectionSummaryText"
                               VerticalAlignment="Center"
                               Foreground="#FFBFD7EB"
                               TextTrimming="CharacterEllipsis"/>

                    <Button Grid.Column="1" Content="Clear Filters &amp; Sorting" Width="160" Margin="6,0,0,0" Style="{StaticResource ModernButton}" Click="SelectAllVisibleButton_Click"/>
                    <Button Grid.Column="2" Content="Cancel" Width="90" Margin="6,0,0,0" Style="{StaticResource ModernButton}" IsCancel="True"/>
                    <Button Grid.Column="3" Content="Apply" Width="90" Margin="6,0,0,0" Style="{StaticResource ModernButton}" IsDefault="True" Click="ApplyButton_Click"/>
                </Grid>
    </Grid>
</local:OceanyaWindowContentControl>
